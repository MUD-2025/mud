#!/bin/bash
PORT=5555
ulimit -c unlimited

# Default flags to pass to the MUD server (see admin.txt for a description
# of all flags).
FLAGS='-q'

#############################################################################

while ( : ) do

  DATE=`date`
  echo "autorun starting game $DATE" >> syslog
  echo "running bin/circle $FLAGS $PORT" >> syslog

  build/circle $FLAGS $PORT 
  mv syslog.CRASH.1 syslog.CRASH.2
  mv syslog.CRASH syslog.CRASH.1
  tail -1000 syslog > syslog.CRASH
  mv lib/core core.1
  chmod 660 core.1

  if [ -r .killscript ]; then
    DATE=`date`;
    echo "autoscript killed $DATE"  >>syslog
    rm .killscript
    exit
  fi

  if [ ! -r .fastboot ]; then
    sleep 60
  else
    rm .fastboot
    sleep 5
  fi

done
